<project name="MM.MySQL" default="dist" basedir=".">
	<property name="version" value="2.0.14"/>
	
	<target name="init">
		<filter token="VERSION" value="${version}"/>
		<delete dir="build"/>

		<copy todir="./build/mysql-jdbc-${version}" filtering="true">
			<fileset dir="." excludes="**/CVS">
				<patternset id="classjar" >
    					<exclude name="**/*.class*"/>
    					<exclude name="**/*.jar"/>
  				</patternset>
			</fileset>
		</copy>
		<copy todir="./build/mysql-jdbc-${version}" filtering="false">
			<fileset dir="." excludes="**/CVS">
				<patternset id="dojar" >
    					<include name="**/*.jar*"/>
  				</patternset>
			</fileset>
		</copy>

	</target>

	<target name="dist" depends="init, compile">
		
		<delete file="./build/mysql-jdbc-${version}-bin.jar"/>
		<delete file="../mysql-jdbc-${version}.jar"/>

		<jar jarfile="./build/mysql-jdbc-${version}/mysql-jdbc-${version}-bin.jar">
			<fileset dir="./build/mysql-jdbc-${version}"
				includes="**/*.class"/>
			<fileset dir="./build/mysql-jdbc-${version}"
				includes="COPYING, README"/>
		</jar>

		<jar jarfile="../mysql-jdbc-${version}.jar">
			<fileset dir="./build">
				<patternset id="non.test.sources" >
    					<exclude name="**/*.nb*"/>
    					<exclude name="**/*.bak"/>
    					<exclude name="**/*.*~"/>
  				</patternset>
			</fileset>
		</jar>
	</target>
	
	<target name="test" depends="compile-testsuite">
	  <junit printSummary="yes">
	  <sysproperty key="com.mysql.jdbc.testsuite.url" value="jdbc:mysql:///test"/>
	  <classpath>
      	 <pathelement location="./build/mysql-jdbc-${version}" />
    	 <pathelement path="${java.class.path}" />
  	  </classpath>

      <formatter type="plain" />
      
      <batchtest fork="no">
    	<fileset dir="./build/mysql-jdbc-${version}">
      	   <include name="**/*Test.java" />
    	</fileset>
      </batchtest>
      </junit>
	</target>

	<target name="compile" depends="init, compile-core, compile-testsuite">
	</target>

	<target name="compile-core" depends="init">
		<javac srcdir="./build/mysql-jdbc-${version}"
			excludes="testsuite/**"
			classpath="./build/mysql-jdbc-${version};lib/jdbc2_0-stdext.jar;lib/jta-spec1_0_1.jar"
			debug="on"
		/>

	</target>


	<target name="compile-testsuite">
		<javac srcdir="./build/mysql-jdbc-${version}"
			excludes="com/mysql/jdbc/**"
			classpath="lib/jdbc2_0-stdext.jar;lib/jta-spec1_0_1.jar;lib-nodist/junit.jar"
		/>

	</target>

	<target name="clean">
		<delete>
			<fileset dir="." includes="**/*.class"/>
		</delete>
	</target>

</project>
